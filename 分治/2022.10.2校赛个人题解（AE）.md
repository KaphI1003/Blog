## A 简单的计算
### 题面
求
$$
\sum_{1\le i\le j\le n} gcd\{a_i,a_{i+1},...,a_j\}*max\{a_i,a_{i+1},...,a_j\}
$$
### 分析
考虑分治，假设当前处理的区间为 $[l,r]$ ，那么我们就要计算左端点在 $[l,mid]$间且右端点在 $[mid+1,r]$间的所有区间的贡献。

先算最大值在 $[mid+1,r]$ 间出现的区间的贡献。

枚举右端点$j$,维护$rmax=max\{a_k|k\in[mid+1,j]\}$,由于右端点为$j$的区间的$gcd$的总数不超过$log_210^9$个，且随左端点的减小$gcd$单调不增，所以我们可以直接记录下所有的$gcd$和对应的区间数量（设为$G[]$和$cnt[]$，$G[]$单调不增）。

那么右端点为$j$且最大值在 $[mid+1,r]$ 间出现的区间的贡献就是

$$
rmax*\sum_i G[i]*cnt[i]
$$

设$rg=gcd(mid+1,j),sum=\sum_i G[i]*cnt[i]$，当移动$j$时如果$rg$改变了，就让所有的$G[]$对新的$rg$取$gcd$，如果$G[i]=G[i-1]$就合并，同时重新计算$sum$。每个$G[]$最多减小$log_210^9$次，所以整个的复杂度是$O(\log^2n)$。

利用尺取找最小的可以让最大值出现在$[mid+1,r]$里的最小左端点$i$，$g=gcd\{a_k|k\in[i,j]\}$。每一次移动，把新产生的$g$算入$G[]$中。

假设左端点从$i+1$移动到$i$，如果$g$没有改变，代表$G[]$的最后一个元素的数量增加一。（$g$永远和$G[]$的最后一个元素相等，移动右端点时也要更新$g$）；如果$g$改变了，那么就把$g$作为新的最后一个元素加入到$G[]$中。同时更新$sum$的值，一次移动时$O(1)$的

那么贡献就直接是$rmax*sum$，$O(1)$求得。计算出所有最大值在右边的区间的贡献的时间复杂度就是$O(n+\log^2n)=O(n)$

同理计算最大值在左边的区间的贡献，分治一层的时间复杂度是$O(n)$，总时间复杂度为$O(n\log n)$。

（考场上没有想到开 $sum$所以复杂度多了一个$\log$）

## E 红黑树

明显的树形DP

考虑有哪些情况符合题目要求，一共
0：无红无黑
1：多红无黑
2：无红多黑
3：多红一黑

这四种情况，考虑以此为状态来转移，不过(2)无红多黑向(3)多红一黑的转移无法写出，因为只有黑只有一个时才能转移，那么把(2)无红多黑的情况拆成两种。新的状态就是

0：无红无黑
1：多红无黑
2：无红一黑
3：无红多黑（黑$\geq$2）
4：多红一黑

那么就可以开始DP了。

每个节点开始时按自身颜色设定DP初值，其余的设成无穷大。设$x$是$y$的父亲,考虑计入$y$的贡献。开一个临时数组$t[5]$来存新的DP值

1.$x$不和$y$连边,设边权为$ew$，那么就不需要考虑$y$的状态，设$mi=min\{dp[y][i],i=0,1,2,3,4\}$,那么直接更新$t[i]=min(t[i],dp[x][i]+mi+ew),i=0,1,2,3,4$
2.$x$和$y$连边,那么合法的组合（加号旁两个数字可互换）有
$0+0\to0; 0+1\to1; 0+2\to2; 0+3\to3; 0+4\to4$
$1+1\to1; 1+2\to4; 1+4\to4$
$2+2\to3; 2+3\to4$
$3+3\to3 $

状态转移完备了，本题结束。时间复杂度为$O(n)$
 