# [Ela Goes Hiking](https://codeforces.com/contest/1737/problem/E)

### 简易题面
一根木棍上$n$只蚂蚁，每只蚂蚁开始时朝向左和朝向右的概率相同，体重都是$1$。当两只蚂蚁相遇时，重的吃掉轻的(同样重右吃左)。该过程一直持续到只剩一只蚂蚁，问每只蚂蚁的存活概率(Mod $ 1e9+7$)。

$1\leq n\leq 1e6$
### 分析
设$f(x)$为第$x$个蚂蚁在第一只到第$\min(2x-1,n)$只蚂蚁间活下来的概率。$x$一开始往右走就是直接送死（除了第$n$只），所以$x$只可以向左走。设$p$为$x$左边最靠近$x$的向左走的蚂蚁。那么$p+1$到$x-1$的蚂蚁都会被$x$吃掉，而不论$1$到$p-1$的蚂蚁如何行动，$1$到$p$在最后都会形成一直重$p$的蚂蚁与$x$相遇。所以$x$要活下来的必要条件是$p \leq x-p$,也就代表只有$\lceil \frac{x+1}{2} \rceil$ 到$x-1$都向右，$x$向左，$x$才能够在$1$到$x$间存活。而$x+1$到$2x-1$要么向右被吃，要么向左经过一番斗争后最后被$x$吃，没有存活的可能。

所以$f(x)=\dfrac{1}{2^{\lfloor \frac{x+1}{2} \rfloor }}$。
而$n$由于右边没有蚂蚁比较特别，向左向右等价，所以$f(n)=\dfrac{1}{2^{\lfloor \frac{n-1}{2} \rfloor }}$。

不过我们还要考虑到$2x$到$n$的蚂蚁走向对$x$的影响。设$g(x)$为$x$最后活下来的概率。那么$ g(x)=f(x) , \lfloor \frac{n}{2} \rfloor +1 \leq x \leq n $恒成立。

考虑如何计算$g(x),x\leq \lfloor \frac{n}{2} \rfloor$。
通过之前的考虑，我们知道了$f(x)$只跟$\lceil \frac{x+1}{2} \rceil $到$x$的蚂蚁的方向有关。同样的我们也可以得出$g(x)$只跟$\lceil \frac{x+1}{2} \rceil $到$n$的蚂蚁方向有关。那么$g(2x)$到$g(n)$就只和$x+1$到$n$的蚂蚁方向有关。**所以$f(x)$与$g(i),i \geq 2x$的概率相互独立。**

那么 $g(x)=f(x)*k$，$k$代表$2x$到$n$的蚂蚁都不存活的概率。

但是$k\ne (1-g(2x))(1-g(2x+1))···(1-g(n)) $，因为$g(x)$之间的概率并不相互独立，但是有一个明显的特征$g(x)*g(y)=0,x\ne y$（很明显两只蚂蚁不可能同时存活）。也就是一个事件发生时另一个事件肯定不会发生。那么将$(1-g(2x))(1-g(2x+1))···(1-g(n)) $展开，我们就可以得到$k=1-\sum_{i=2x}^{n}g(i)$。（这里是我瞎口胡的，应该是有对应的概率模型，和概率论有关吧（乱说））。

所以$g(x)=f(x)*(1-\sum_{i=2x}^{n}g(i))$，答案就是$g(x)$


