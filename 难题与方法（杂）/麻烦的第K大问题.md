# 麻烦的第K大问题

#### 题目描述：

给定n个数，令符号[l, r, t]表示第l个数到第r个数中第t大的值。

对于给定的len、y和k，求多重集${[l,r,\lfloor \frac{r-l+1}{len} \rfloor *y] | (r-l+1) \mod len=0}$中的第k大值

具体来说，这个多重集包含：

每个长度是len的区间中第y大的值，

每个长度是2len的区间中第2y大的值，

每个长度是3len的区间中第3y大的值，

……

以此类推。

对于下面的样例，这个多重集是{2, 3, 3, 4}。

###### Input
第一行四个数，n, len, y, k (n ≤ 100000, y ≤ len ≤ n, k ≤ 长度为len倍数的区间个数)

第二行n个，每个数 ≤ n

###### Output
输出一个数表示答案

###### Sample Input
4 2 1 3

2 1 3 4
###### Sample Output
3

### 分析：
关于这种有单调可言的题目来说，二分答案是很好想
到的，所以第一维先二分答案，然后就是判断的问题了。

我们可以先开一个前缀和数组 $sum$，把每一个大于等于 $mid$ 的数都标记成 $1$ 。再前缀和。再求出有多少个大于等于 $mid$ 的数在多重集之中。若有一对（ $i$, $j$ ）满足
$$
sum[i]-sum[i-j*len]>=j*y
$$
则多重集中有一个大于等于 $mid$ 的数。

但是强行枚举一定会超时，所以要想出一个更好的办法或对式子进行优化。那么优化的最好的办法之一就是进行 **参数分离** 。我们设 $x \in [0,len-1]$ 那么式子可以变形为

$$
sum[x+i*len]-sum[x+j*len] \ge (i-j)*y,j\leq i
$$
可以分离为
$$
sum[x+i*len]-i*y>=sum[x+j*len]-j*y,j\leq i
$$
然后从小到大枚举 $x$ 和 $i$ ，用树状数组来维护   $sum[x+i * len]-i * y$  的值就可以了。

时间复杂度 
$$
O(nlog^2n)
$$
